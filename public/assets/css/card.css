/* public/assets/css/card.css
   ChicCanto scratch card styles

   Background strategy:
   - Per-card bg-desktop.jpg / bg-mobile.jpg rendered via <picture> + <img>
   - Export strategy: export inlines <img> (uses currentSrc), so backgrounds are export-safe.
*/

/* Prevent text selection while scratching */
.scratch-stage,
.scratch-stage *{
  -webkit-user-select: none;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
}

/* Card FX wrapper */
.scratch-fx{
  width: var(--scratch-fx-width, min(100%, var(--scratch-max, 980px)));
  max-width: 100%;
  margin: 0 auto;
  position: relative;
  z-index: 2;
  border-radius: var(--scratch-fx-radius, 28px);
  overflow: visible;
  display: block;
  cursor: default;
  filter:
    drop-shadow(0 22px 55px rgba(0,0,0,.55))
    drop-shadow(0 6px 18px rgba(0,0,0,.35));
}

/* The scratch stage (the card) */
.scratch-stage{
  position: relative;
  isolation: isolate;
  border-radius: 28px;
  overflow: hidden;
  z-index: 100;
  padding: 1rem;
  width: 100%;
  box-shadow: 0 18px 50px rgba(0,0,0,0.35);

  /* Safe base color under the bg image */
  background: #1c1e1e;
}

/* Make the scratch card fill the fx wrapper exactly */
.scratch-fx > .scratch-stage{
  width: 100%;
  max-width: none;
  box-sizing: border-box;
  border-radius: inherit;
  position: relative;
  z-index: 1;
}

/* -----------------------------
   Background image layer
   ----------------------------- */
.card-bg{
  position: absolute;
  inset: 0;
  z-index: 0;
  pointer-events: none;
}

.card-bg__img{
  width: 100%;
  height: 100%;
  display: block;
  object-fit: cover;        /* acts like background-size: cover */
  object-position: center;  /* acts like background-position: center */
}

/* Ensure content stays above bg */
.scratch-stage > :not(.card-bg){
  position: relative;
  z-index: 1;
}

/* Kill the old pattern overlay layer entirely (no more CSS backgrounds) */
.scratch-stage__inner{
  display: none !important;
}

/* Title */
.scratch-stage__title{
  margin: 0;
  padding: 0;
}

/* -----------------------------
   Layout: desktop two-column card
   ----------------------------- */
.card-screen__body{
  display: grid;
  grid-template-columns: 1fr 1.25fr;
  gap: 1.25rem;

  /* Key: make both columns equal height */
  align-items: stretch;
}

/* Left panel */
.card-legend.panel{
  border-radius: 18px;
  padding: 1.1rem 1.1rem;

  /* Key: let it stretch cleanly */
  height: 100%;
  display: flex;
  flex-direction: column;
}

/* Right panel wrapper: center the grid inside a full-height column */
.scratch-board{
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Grid */
.scratch-grid{
  display: grid;
  gap: 18px;

  /* Tile size: responsive (desktop) */
  --tile-size: clamp(96px, calc((100vw - 72px - (18px * 2)) / 3), 170px);

  grid-template-columns: repeat(3, var(--tile-size));
  justify-content: center;
}

/* Tile */
.scratch-board .scratch-tile{
  position: relative;
  width: var(--tile-size);
  height: var(--tile-size);
  border-radius: 9999px;
  overflow: hidden;
  aspect-ratio: 1 / 1;
  min-height: 76px;
  background: #fff;
}

/* Underlay icon */
.scratch-tile .under{
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.scratch-tile .under img{
  display: block;
  width: 80%;
  height: 80%;
  object-fit: contain;
}

/* Scratch canvas */
.scratch-tile canvas{
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  touch-action: none;
  border-radius: 9999px;
}

/* -----------------------------
   Mobile stack
   ----------------------------- */
@media (max-width: 720px){
  .card-screen__body{
    grid-template-columns: 1fr;
    gap: 1rem;
    align-items: start; /* avoid forcing tall equal-height behavior on stacked layout */
  }

  /* Board first, legend below */
  .scratch-board{
    height: auto;
    justify-content: center;
  }

  .card-legend.panel{
    height: auto;
    margin-top: 12px;
  }

  .scratch-grid{
    gap: 12px;

    /* Clamp harder so the grid doesn't become a skyscraper on phones */
    --tile-size: clamp(84px, calc((100vw - 56px - (12px * 2)) / 3), 120px);

    grid-template-columns: repeat(3, var(--tile-size));
  }
}

/* Landscape phone */
@media (orientation: landscape) and (max-height: 520px){
  .scratch-grid{
    gap: 12px;
    --tile-size: clamp(80px, calc((100vw - 100px - (12px * 2)) / 3), 110px);
  }
}
