<!doctype html>
<!-- /public/open/index.html -->
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Open card | ChicCanto</title>
  <link rel="icon" href="/favicon.ico" />
  <link rel="stylesheet" href="/assets/css/base.css" />
</head>

<body data-page="redeem">
  <header class="site-header">
    <div class="site-header__inner">
      <a class="brand" href="/activate/" aria-label="ChicCanto activate">
        <img alt="ChicCanto" class="brand__logo" src="/assets/img/logo1.svg" />
      </a>

      <div class="site-header__actions">
        <a class="btn btn-ghost" href="/faq/">FAQ</a>
      </div>
    </div>
  </header>

  <main class="flow-shell">
    <section class="flow-hero">
      <div class="flow-kicker">OPEN TO PLAY</div>
      <h1 class="flow-title">Open this link in your browser</h1>
      <p class="flow-subtitle">
        Facebook Messenger and Instagram in-app browsers can break scratching and reset the card.
        For a stable reveal, open in Safari or Chrome.
      </p>
    </section>

    <section class="flow-panel flow-panel--combined panel--glass">
      <div class="panel-meta">
        <span>Step 1</span>
        <span class="panel-hint">Opens the card in your browser</span>
      </div>

      <div class="panel-body">
        <label class="field-label" for="cardLink">Card link</label>
        <div class="field-row">
          <input id="cardLink" class="input" type="text" readonly value="" />
        </div>

        <div class="btn-row">
          <button id="openBtn" class="btn btn-primary" type="button">Open</button>
          <button id="copyBtn" class="btn btn-ghost" type="button">Copy</button>
        </div>

        <p class="panel-note">
          If you are viewing this inside Messenger on iPhone: tap the <strong>…</strong> menu and choose <strong>Open in Safari</strong>.
          If you cannot find it, tap <strong>Copy</strong>, paste the link into Safari or Chrome, then open.
        </p>

        <a id="continueLink" class="link-muted" href="#">Continue here anyway</a>
      </div>
    </section>

    <footer class="flow-footer">
      <a class="link-muted" href="/privacy/">Privacy</a>
      <span class="dot">•</span>
      <a class="link-muted" href="mailto:chiccanto@wearrs.com">chiccanto@wearrs.com</a>
    </footer>
  </main>

  <script>
    (function () {
      const params = new URLSearchParams(window.location.search);
      const token = params.get("token");

      const origin = window.location.origin;
      const cardUrl = token ? `${origin}/card/?token=${encodeURIComponent(token)}` : `${origin}/`;

      const input = document.getElementById("cardLink");
      const openBtn = document.getElementById("openBtn");
      const copyBtn = document.getElementById("copyBtn");
      const continueLink = document.getElementById("continueLink");

      input.value = cardUrl;
      continueLink.href = cardUrl;

      openBtn.addEventListener("click", () => {
        window.location.href = cardUrl;
      });

      copyBtn.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(cardUrl);
          copyBtn.textContent = "Copied";
          window.setTimeout(() => (copyBtn.textContent = "Copy"), 1200);
        } catch (e) {
          input.focus();
          input.select();
          document.execCommand("copy");
          copyBtn.textContent = "Copied";
          window.setTimeout(() => (copyBtn.textContent = "Copy"), 1200);
        }
      });

      if (!token) {
        openBtn.disabled = true;
        copyBtn.disabled = true;
        continueLink.style.display = "none";
        input.value = "Missing token in link.";
      }
    })();
  </script>
</body>
</html>
