<!DOCTYPE html>
<!-- /public/open/index.html -->
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width,initial-scale=1" name="viewport"/>
  <title>ChicCanto | Open</title>
  <link href="/favicon.ico" rel="icon"/>
  <link href="/assets/css/base.css" rel="stylesheet"/>
</head>

<body class="theme-default" data-page="redeem">
  <header class="site-header">
    <div class="site-header__inner">
      <a class="brand" href="/activate/" aria-label="ChicCanto activate">
        <img alt="ChicCanto" class="brand__logo" src="/assets/img/logo1.svg"/>
      </a>
      <div class="site-header__actions">
        <a class="btn outline" href="/faq/">FAQ</a>
      </div>
    </div>
  </header>

  <main class="page-main">
    <div class="container">
      <section class="flow-screen">
        <div class="flow-layout">
          <div class="flow-intro">
            <h1 class="flow-title">Open in your browser</h1>
            <p class="flow-lead muted panel-meta">
              Some chat apps open links inside a built-in browser. That can reset the card while scratching.
              For a stable reveal, open this link in your phone’s browser.
            </p>
          </div>

          <section aria-label="Open card" class="flow-panel--combined panel panel--glass panel--padded">
            <div class="panel-meta">
              <div>Step 1</div>
              <div class="flow-panel__hint" id="hintRight">Copy the link and open it in your browser</div>
            </div>

            <div class="control-grid">
              <div class="field">
                <label class="label" for="cardLink">Card link</label>
                <input class="input" id="cardLink" readonly type="text" value=""/>
              </div>

              <div class="actions">
                <button class="btn primary" id="copyBtn" type="button">Copy link</button>
                <button class="btn outline" id="openBtn" type="button">Open</button>
              </div>

              <div class="muted small" id="helpText" style="margin-top: 2px;">
                If your app shows the card inside a built-in browser, use the <strong>…</strong> menu and choose <strong>Open in browser</strong> (or similar).
                If you can’t find that option, paste the copied link into your browser.
              </div>

              <a class="muted small" href="#" id="continueLink">Continue here anyway</a>
            </div>
          </section>
        </div>
      </section>

      <footer class="site-footer">
        <a class="footer-link" href="/privacy/">Privacy</a>
        <span class="dot">•</span>
        <a class="footer-link" href="mailto:chiccanto@wearrs.com">chiccanto@wearrs.com</a>
      </footer>
    </div>
  </main>

  <script>
    (function () {
      const params = new URLSearchParams(window.location.search);
      const token = params.get("token");

      const origin = window.location.origin;
      const cardUrl = token ? `${origin}/card/?token=${encodeURIComponent(token)}` : `${origin}/`;

      const ua = navigator.userAgent || "";
      const isMobile = /(iPhone|iPad|iPod|Android|Mobi)/i.test(ua);
      const isInApp = /(FBAN|FBAV|FB_IAB|FB4A|FBMD|Instagram|Messenger)/i.test(ua);

      const input = document.getElementById("cardLink");
      const openBtn = document.getElementById("openBtn");
      const copyBtn = document.getElementById("copyBtn");
      const continueLink = document.getElementById("continueLink");
      const hintRight = document.getElementById("hintRight");
      const helpText = document.getElementById("helpText");

      input.value = cardUrl;
      continueLink.href = cardUrl;

      const setCopied = () => {
        copyBtn.textContent = "Copied";
        window.setTimeout(() => (copyBtn.textContent = "Copy link"), 1200);
      };

      copyBtn.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(cardUrl);
          setCopied();
        } catch (e) {
          input.focus();
          input.select();
          document.execCommand("copy");
          setCopied();
        }
      });

      openBtn.addEventListener("click", () => {
        window.location.href = cardUrl;
      });

      // Desktop: Open is useful. Mobile in-app: Open is misleading (still in-app).
      if (isInApp && isMobile) {
        openBtn.style.display = "none";
        hintRight.textContent = "Copy the link, then open it in your browser";
        helpText.innerHTML =
          "This link opened inside a built-in browser. Tap <strong>Copy link</strong>, then paste into your phone’s browser. " +
          "If your app offers an <strong>Open in browser</strong> option in the <strong>…</strong> menu, you can use that instead.";
      } else if (!isInApp) {
        hintRight.textContent = "Open the card";
        helpText.textContent = "If the card behaves strangely in a chat app, copy the link and open it in your browser.";
      }

      if (!token) {
        openBtn.disabled = true;
        copyBtn.disabled = true;
        continueLink.style.display = "none";
        input.value = "Missing token in link.";
        hintRight.textContent = "Missing token";
        helpText.textContent = "This link is missing a token.";
      }
    })();
  </script>
</body>
</html>
