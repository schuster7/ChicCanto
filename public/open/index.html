<!DOCTYPE html>
<!-- /public/open/index.html -->
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width,initial-scale=1" name="viewport"/>
  <title>ChicCanto | Open</title>
  <link href="/favicon.ico" rel="icon"/>
  <link href="/assets/css/base.css" rel="stylesheet"/>
</head>

<body class="theme-default" data-page="redeem">
  <header class="site-header">
    <div class="site-header__inner">
      <a class="brand" href="/activate/" aria-label="ChicCanto activate">
        <img alt="ChicCanto" class="brand__logo" src="/assets/img/logo1.svg"/>
      </a>
      <div class="site-header__actions">
        <a class="btn outline" href="/faq/">FAQ</a>
      </div>
    </div>
  </header>

  <main class="page-main">
    <div class="container">
      <section class="flow-screen">
        <div class="flow-layout">
          <div class="flow-intro">
            <h1 class="flow-title">Open this link in your browser</h1>
            <p class="flow-lead muted panel-meta">
              Facebook Messenger and Instagram in-app browsers can reset the card while scratching.
              For a stable reveal, open in Safari or Chrome.
            </p>
          </div>
<section aria-label="Open card" class="flow-panel--combined panel panel--glass panel--padded">
            <div class="panel-meta">
              <div>Step 1</div>
              <div class="flow-panel__hint">Opens the card in your browser</div>
            </div>

            <div class="control-grid">
              <div class="field">
                <label class="label" for="cardLink">Card link</label>
                <input class="input" id="cardLink" readonly type="text" value=""/>
              </div>

              <div class="actions">
                <button class="btn primary" id="openBtn" type="button">Open</button>
                <button class="btn outline" id="copyBtn" type="button">Copy</button>
              </div>

              <p class="muted small" style="margin-top: 2px;">
                If you are viewing this inside Messenger on iPhone: tap the <strong>…</strong> menu and choose <strong>Open in Safari</strong>.
                If you cannot find it, tap <strong>Copy</strong>, paste into Safari/Chrome, then open.
              </p>

              <a class="muted small" href="#" id="continueLink">Continue here anyway</a>
            </div>
          </section>
        </div>
      </section>

      <footer class="site-footer">
        <a class="footer-link" href="/privacy/">Privacy</a>
        <span class="dot">•</span>
        <a class="footer-link" href="mailto:chiccanto@wearrs.com">chiccanto@wearrs.com</a>
      </footer>
    </div>
  </main>

  <script>
    (function () {
      const params = new URLSearchParams(window.location.search);
      const token = params.get("token");

      const origin = window.location.origin;
      const cardUrl = token ? `${origin}/card/?token=${encodeURIComponent(token)}` : `${origin}/`;

      const input = document.getElementById("cardLink");
      const openBtn = document.getElementById("openBtn");
      const copyBtn = document.getElementById("copyBtn");
      const continueLink = document.getElementById("continueLink");

      input.value = cardUrl;
      continueLink.href = cardUrl;

      openBtn.addEventListener("click", () => {
        window.location.href = cardUrl;
      });

      copyBtn.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(cardUrl);
          copyBtn.textContent = "Copied";
          window.setTimeout(() => (copyBtn.textContent = "Copy"), 1200);
        } catch (e) {
          input.focus();
          input.select();
          document.execCommand("copy");
          copyBtn.textContent = "Copied";
          window.setTimeout(() => (copyBtn.textContent = "Copy"), 1200);
        }
      });

      if (!token) {
        openBtn.disabled = true;
        copyBtn.disabled = true;
        continueLink.style.display = "none";
        input.value = "Missing token in link.";
      }
    })();
  </script>
</body>
</html>
